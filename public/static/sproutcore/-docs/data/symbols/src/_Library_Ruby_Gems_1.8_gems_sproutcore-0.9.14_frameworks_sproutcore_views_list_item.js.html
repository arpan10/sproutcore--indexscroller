<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
  .KEYW {color: #933;}
  .COMM {color: #bbb; font-style: italic;}
  .NUMB {color: #393;}
  .STRN {color: #393;}
  .REGX {color: #339;}
  .line {border-right: 1px dotted #666; color: #666; font-style: normal;}
  </style></head><body><pre><span class='line'>  1</span> <span class="COMM">// ==========================================================================</span><span class="WHIT">
<span class='line'>  2</span> </span><span class="COMM">// SC.ListItemView</span><span class="WHIT">
<span class='line'>  3</span> </span><span class="COMM">// ==========================================================================</span><span class="WHIT">
<span class='line'>  4</span> 
<span class='line'>  5</span> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'core'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>  6</span> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'views/view'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>  7</span> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'mixins/control'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>  8</span> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'mixins/inline_editor_delegate'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>  9</span> 
<span class='line'> 10</span> </span><span class="NAME">SC.LIST_ITEM_ACTION_CANCEL</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'sc-list-item-cancel-action'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 11</span> </span><span class="NAME">SC.LIST_ITEM_ACTION_REFRESH</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'sc-list-item-cancel-refresh'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 12</span> </span><span class="NAME">SC.LIST_ITEM_ACTION_EJECT</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'sc-list-item-cancel-eject'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 13</span> 
<span class='line'> 14</span> </span><span class="COMM">/** @class
<span class='line'> 15</span> 
<span class='line'> 16</span>   Displays a list item with a label, optional icon, count, and right icon.
<span class='line'> 17</span> 
<span class='line'> 18</span>   @extends SC.View
<span class='line'> 19</span>   @extends SC.Control
<span class='line'> 20</span>   @extends SC.InlineEditorDelegate
<span class='line'> 21</span>   @extends SC.Editable
<span class='line'> 22</span>   @author  Charles Jolley  
<span class='line'> 23</span>   @since SproutCore 1.0
<span class='line'> 24</span> */</span><span class="WHIT">
<span class='line'> 25</span> </span><span class="NAME">SC.ListItemView</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.View.extend</span><span class="PUNC">(</span><span class="NAME">SC.Control</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">SC.InlineEditorDelegate</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 26</span> </span><span class="COMM">/** @scope SC.ListItemView.prototype */</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 27</span>   
<span class='line'> 28</span>   </span><span class="COMM">/** A ListItemView has an img tag, label, count, optional right button, and
<span class='line'> 29</span>     an optional right arrow.  These items are made visible/hidden based on a
<span class='line'> 30</span>     variety of CSS classes.
<span class='line'> 31</span>   */</span><span class="WHIT">
<span class='line'> 32</span>   </span><span class="NAME">emptyElement</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'&lt;div class="sc-list-item-view sc-collection-item">&lt;/div>'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 33</span>   
<span class='line'> 34</span>   </span><span class="COMM">/**
<span class='line'> 35</span>     The content object the list item will display.
<span class='line'> 36</span>   */</span><span class="WHIT">
<span class='line'> 37</span>   </span><span class="NAME">content</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 38</span>   
<span class='line'> 39</span>   </span><span class="COMM">/**
<span class='line'> 40</span>     (displayDelegate) True if you want the item view to display an icon.
<span class='line'> 41</span>     
<span class='line'> 42</span>     If false, the icon on the list item view will be hidden.  Otherwise,
<span class='line'> 43</span>     space will be left for the icon next to the list item view.
<span class='line'> 44</span>   */</span><span class="WHIT">
<span class='line'> 45</span>   </span><span class="NAME">hasContentIcon</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 46</span>   
<span class='line'> 47</span>   </span><span class="COMM">/**
<span class='line'> 48</span>     (displayDelegate) True if you want space to be allocated for a branch 
<span class='line'> 49</span>     arrow.
<span class='line'> 50</span>     
<span class='line'> 51</span>     If false, the space for the branch arrow will be collapsed.
<span class='line'> 52</span>   */</span><span class="WHIT">
<span class='line'> 53</span>   </span><span class="NAME">hasContentBranch</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 54</span>   
<span class='line'> 55</span>   </span><span class="COMM">/**
<span class='line'> 56</span>     (displayDelegate) Property key to use for the icon url
<span class='line'> 57</span> 
<span class='line'> 58</span>     This property will be checked on the content object to determine the 
<span class='line'> 59</span>     icon to display.  It must return either a URL or a CSS class name.
<span class='line'> 60</span>   */</span><span class="WHIT">
<span class='line'> 61</span>   </span><span class="NAME">contentIconKey</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 62</span>   
<span class='line'> 63</span>   </span><span class="COMM">/**
<span class='line'> 64</span>     (displayDelegate) The name of the property used for label itself
<span class='line'> 65</span>     
<span class='line'> 66</span>     If null, then the content object itself will be used..
<span class='line'> 67</span>   */</span><span class="WHIT">
<span class='line'> 68</span>   </span><span class="NAME">contentValueKey</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 69</span>   
<span class='line'> 70</span>   </span><span class="COMM">/**
<span class='line'> 71</span>     (displayDelegate) The name of the property used to find the count of 
<span class='line'> 72</span>     unread items. 
<span class='line'> 73</span>     
<span class='line'> 74</span>     The count will only be visible if this property is not null and the 
<span class='line'> 75</span>     returned value is not 0.
<span class='line'> 76</span>   */</span><span class="WHIT">
<span class='line'> 77</span>   </span><span class="NAME">contentUnreadCountKey</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 78</span>   
<span class='line'> 79</span>   </span><span class="COMM">/**
<span class='line'> 80</span>     (displayDelegate) The name of the property used to determine if the item
<span class='line'> 81</span>     is a branch or leaf (i.e. if the branch icon should be displayed to the
<span class='line'> 82</span>     right edge.)
<span class='line'> 83</span>     
<span class='line'> 84</span>     If this is null, then the branch view will be completely hidden.
<span class='line'> 85</span>     Otherwise space will be allocated for it.
<span class='line'> 86</span>   */</span><span class="WHIT">
<span class='line'> 87</span>   </span><span class="NAME">contentIsBranchKey</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 88</span>   
<span class='line'> 89</span>   </span><span class="COMM">/**
<span class='line'> 90</span>     YES if the item view is currently editing.
<span class='line'> 91</span>   */</span><span class="WHIT">
<span class='line'> 92</span>   </span><span class="NAME">isEditing</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 93</span>   
<span class='line'> 94</span>   </span><span class="NAME">contentPropertyDidChange</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 95</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isEditing'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.discardEditing</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 96</span>     </span><span class="NAME">this.render</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">  
<span class='line'> 97</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 98</span>   
<span class='line'> 99</span>   
<span class='line'>100</span>   </span><span class="COMM">/**
<span class='line'>101</span>     Regenerates the innerHTML for this view and updates it if necessary.
<span class='line'>102</span>   */</span><span class="WHIT">
<span class='line'>103</span>   </span><span class="NAME">render</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>104</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">html</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>105</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>106</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">del</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.displayDelegate</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>107</span>     
<span class='line'>108</span>     </span><span class="COMM">// handle icon</span><span class="WHIT">
<span class='line'>109</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.getDelegateProperty</span><span class="PUNC">(</span><span class="NAME">del</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'hasContentIcon'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>110</span>        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">iconKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getDelegateProperty</span><span class="PUNC">(</span><span class="NAME">del</span><span class="PUNC">,</span><span class="STRN">'contentIconKey'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>111</span>        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">icon</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">iconKey</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">content.get</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">content.get</span><span class="PUNC">(</span><span class="NAME">iconKey</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>112</span>        </span><span class="NAME">html.push</span><span class="PUNC">(</span><span class="NAME">this.renderIconHtml</span><span class="PUNC">(</span><span class="NAME">icon</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>113</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>114</span>     
<span class='line'>115</span>     </span><span class="COMM">// handle label</span><span class="WHIT">
<span class='line'>116</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">labelKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getDelegateProperty</span><span class="PUNC">(</span><span class="NAME">del</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'contentValueKey'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>117</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">label</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">labelKey</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">content.get</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">content.get</span><span class="PUNC">(</span><span class="NAME">labelKey</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>118</span>     </span><span class="NAME">html.push</span><span class="PUNC">(</span><span class="NAME">this.renderLabelHtml</span><span class="PUNC">(</span><span class="NAME">label</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>119</span>     
<span class='line'>120</span>     </span><span class="COMM">// handle unread count</span><span class="WHIT">
<span class='line'>121</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">countKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getDelegateProperty</span><span class="PUNC">(</span><span class="NAME">del</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'contentUnreadCountKey'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>122</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">count</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">countKey</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">content.get</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">content.get</span><span class="PUNC">(</span><span class="NAME">countKey</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>123</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">count</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">count</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>124</span>       </span><span class="NAME">html.push</span><span class="PUNC">(</span><span class="NAME">this.renderCountHtml</span><span class="PUNC">(</span><span class="NAME">count</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>125</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>126</span>     
<span class='line'>127</span>     </span><span class="COMM">// handle action </span><span class="WHIT">
<span class='line'>128</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">actionKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getDelegateProperty</span><span class="PUNC">(</span><span class="NAME">del</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'listItemActionProperty'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>129</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">actionClassName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">actionKey</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">content.get</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">content.get</span><span class="PUNC">(</span><span class="NAME">actionKey</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>130</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">actionClassName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>131</span>        </span><span class="NAME">html.push</span><span class="PUNC">(</span><span class="NAME">this.renderActionHtml</span><span class="PUNC">(</span><span class="NAME">actionClassName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>132</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>133</span>     </span><span class="NAME">this.setClassName</span><span class="PUNC">(</span><span class="STRN">'sc-has-action'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">actionClassName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>134</span>     
<span class='line'>135</span>     </span><span class="COMM">// handle branch</span><span class="WHIT">
<span class='line'>136</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.getDelegateProperty</span><span class="PUNC">(</span><span class="NAME">del</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'hasContentBranch'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>137</span>       </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">branchKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getDelegateProperty</span><span class="PUNC">(</span><span class="NAME">del</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'contentIsBranchKey'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>138</span>       </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">hasBranch</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">branchKey</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">content.get</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">content.get</span><span class="PUNC">(</span><span class="NAME">branchKey</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>139</span>       </span><span class="NAME">html.push</span><span class="PUNC">(</span><span class="NAME">this.renderBranchHtml</span><span class="PUNC">(</span><span class="NAME">hasBranch</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>140</span>       </span><span class="NAME">this.setClassName</span><span class="PUNC">(</span><span class="STRN">'sc-has-branch'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>141</span>     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">this.setClassName</span><span class="PUNC">(</span><span class="STRN">'sc-has-branch'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>142</span>     
<span class='line'>143</span>     </span><span class="NAME">html</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">html.join</span><span class="PUNC">(</span><span class="STRN">''</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>144</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">html</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">this._lastRenderedHtml</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>145</span>       </span><span class="NAME">this._lastRenderedHtml</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">html</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>146</span>       </span><span class="NAME">this.set</span><span class="PUNC">(</span><span class="STRN">'innerHTML'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">html</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>147</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>148</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>149</span>   
<span class='line'>150</span>   </span><span class="COMM">/** 
<span class='line'>151</span>      renderIconHtml generates the html string used to represent the icon for 
<span class='line'>152</span>      your list item.  override this to return your own custom HTML
<span class='line'>153</span>      
<span class='line'>154</span>      @returns {String}
<span class='line'>155</span>      @arguments {String} the icon property based on your view's contentIconKey
<span class='line'>156</span>    */</span><span class="WHIT">
<span class='line'>157</span>    </span><span class="NAME">renderIconHtml</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">icon</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>158</span>      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">html</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>159</span>      </span><span class="COMM">// get a class name and url to include if relevant</span><span class="WHIT">
<span class='line'>160</span>      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">url</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>161</span>      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">icon</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">SC.ImageView.valueIsUrl</span><span class="PUNC">(</span><span class="NAME">icon</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>162</span>        </span><span class="NAME">url</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">icon</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>163</span>      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>164</span>        </span><span class="NAME">className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">icon</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">url</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">static_url</span><span class="PUNC">(</span><span class="STRN">'blank.gif'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>165</span>      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>166</span>      </span><span class="NAME">html.push</span><span class="PUNC">(</span><span class="STRN">'&lt;img class="sc-icon '</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>167</span>      </span><span class="NAME">html.push</span><span class="PUNC">(</span><span class="NAME">className</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>168</span>      </span><span class="NAME">html.push</span><span class="PUNC">(</span><span class="STRN">'" src="'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>169</span>      </span><span class="NAME">html.push</span><span class="PUNC">(</span><span class="NAME">url</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">static_url</span><span class="PUNC">(</span><span class="STRN">'blank.gif'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>170</span>      </span><span class="NAME">html.push</span><span class="PUNC">(</span><span class="STRN">'" />'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>171</span>      </span><span class="NAME">html</span><span class="PUNC">=</span><span class="NAME">html.join</span><span class="PUNC">(</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>172</span>      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">html</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>173</span>    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>174</span>    
<span class='line'>175</span>    </span><span class="COMM">/** 
<span class='line'>176</span>        renderLabelHtml generates the html string used to represent the label 
<span class='line'>177</span>        for your list item.  override this to return your own custom HTML
<span class='line'>178</span>        
<span class='line'>179</span>        @returns {String}
<span class='line'>180</span>        @arguments {String} the label property based on your view's 
<span class='line'>181</span>         contentValueKey
<span class='line'>182</span>      */</span><span class="WHIT">
<span class='line'>183</span>    </span><span class="NAME">renderLabelHtml</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">label</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>184</span>      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">html</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>185</span>      </span><span class="NAME">html.push</span><span class="PUNC">(</span><span class="STRN">'&lt;span class="sc-label">'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>186</span>      </span><span class="NAME">html.push</span><span class="PUNC">(</span><span class="NAME">label</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>187</span>      </span><span class="NAME">html.push</span><span class="PUNC">(</span><span class="STRN">'&lt;/span>'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>188</span>      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">html.join</span><span class="PUNC">(</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">    
<span class='line'>189</span>    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>190</span>    
<span class='line'>191</span>    </span><span class="COMM">/**
<span class='line'>192</span>       Finds and retrieves the element containing the label.  This is used
<span class='line'>193</span>       for inline editing.  If you override renderLabelHtml() you probably
<span class='line'>194</span>       need to override this as well.
<span class='line'>195</span>   */</span><span class="WHIT">
<span class='line'>196</span>    </span><span class="NAME">findLabelElement</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>197</span>      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.$class</span><span class="PUNC">(</span><span class="STRN">'sc-label'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>198</span>    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>199</span>    
<span class='line'>200</span>    </span><span class="COMM">/** 
<span class='line'>201</span>         renderCountHtml generates the html string used to represent the count 
<span class='line'>202</span>         (like unread count) for your list item.  override this to return your 
<span class='line'>203</span>         own custom HTML
<span class='line'>204</span>         
<span class='line'>205</span>         @returns {String}
<span class='line'>206</span>         @arguments {Integer} the label property based on your view's 
<span class='line'>207</span>          contentValueKey
<span class='line'>208</span>     */</span><span class="WHIT">
<span class='line'>209</span>    </span><span class="NAME">renderCountHtml</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">count</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>210</span>      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">html</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>211</span>       </span><span class="NAME">html.push</span><span class="PUNC">(</span><span class="STRN">'&lt;span class="sc-count">&lt;span class="inner">'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>212</span>        </span><span class="NAME">html.push</span><span class="PUNC">(</span><span class="NAME">count.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>213</span>        </span><span class="NAME">html.push</span><span class="PUNC">(</span><span class="STRN">'&lt;/span>&lt;/span>'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>214</span>        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">html.join</span><span class="PUNC">(</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>215</span>    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>216</span>    
<span class='line'>217</span>    </span><span class="COMM">/** 
<span class='line'>218</span>       renderActionHtml generates the html string used to represent the 
<span class='line'>219</span>       action item for your list item.  override this to return your own 
<span class='line'>220</span>       custom HTML
<span class='line'>221</span>     
<span class='line'>222</span>       @returns {String}
<span class='line'>223</span>       @param actionClassName {String} the name of the action item.
<span class='line'>224</span>     */</span><span class="WHIT">
<span class='line'>225</span>    </span><span class="NAME">renderActionHtml</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">actionClassName</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>226</span>      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">html</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>227</span>      </span><span class="NAME">html.push</span><span class="PUNC">(</span><span class="STRN">'&lt;img src="'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>228</span>      </span><span class="NAME">html.push</span><span class="PUNC">(</span><span class="NAME">static_url</span><span class="PUNC">(</span><span class="STRN">'blank.gif'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>229</span>      </span><span class="NAME">html.push</span><span class="PUNC">(</span><span class="STRN">'" class="sc-action" />'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>230</span>      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">html.join</span><span class="PUNC">(</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>231</span>    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>232</span>    
<span class='line'>233</span>    </span><span class="COMM">/** 
<span class='line'>234</span>      renderBranchHtml generates the html string used to represent the 
<span class='line'>235</span>      branch arrow. override this to return your own custom HTML
<span class='line'>236</span>      @returns {String}
<span class='line'>237</span>      @arguments {Boolean} whehter the branch is 
<span class='line'>238</span>    */</span><span class="WHIT">
<span class='line'>239</span>    
<span class='line'>240</span>    </span><span class="NAME">renderBranchHtml</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">hasBranch</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>241</span>      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">html</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>242</span>      </span><span class="NAME">html.push</span><span class="PUNC">(</span><span class="STRN">'&lt;span class="sc-branch '</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>243</span>      </span><span class="NAME">html.push</span><span class="PUNC">(</span><span class="NAME">hasBranch</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">'sc-branch-visible'</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'sc-branch-hidden'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>244</span>      </span><span class="NAME">html.push</span><span class="PUNC">(</span><span class="STRN">'">&nbsp;&lt;/span>'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>245</span>      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">html.join</span><span class="PUNC">(</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>246</span>    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>247</span>    
<span class='line'>248</span>    </span><span class="COMM">/** 
<span class='line'>249</span>     Returns true if a click is on the label text itself to enable editing.
<span class='line'>250</span>     
<span class='line'>251</span>     Note that if you override renderLabelHtml(), you probably need to override 
<span class='line'>252</span>     this as well.
<span class='line'>253</span>   
<span class='line'>254</span>     @param evt {Event} the mouseUp event.
<span class='line'>255</span>     @returns {Boolean} YES if the mouse was on the content element itself.
<span class='line'>256</span>    */</span><span class="WHIT">
<span class='line'>257</span>    </span><span class="NAME">contentHitTest</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>258</span>      
<span class='line'>259</span>      </span><span class="COMM">// if not content value is returned, not much to do.</span><span class="WHIT">
<span class='line'>260</span>      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">del</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.displayDelegate</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>261</span>      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">labelKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getDelegateProperty</span><span class="PUNC">(</span><span class="NAME">del</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'contentValueKey'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>262</span>      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">labelKey</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>263</span>      
<span class='line'>264</span>      </span><span class="COMM">// get the element to check for.</span><span class="WHIT">
<span class='line'>265</span>      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.findLabelElement</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>266</span>      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// no label to check for.</span><span class="WHIT">
<span class='line'>267</span>      
<span class='line'>268</span>      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cur</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Event.element</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>269</span>      </span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">cur</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cur</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.rootElement</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cur</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">window</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>270</span>        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cur</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>271</span>        </span><span class="NAME">cur</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cur.parentNode</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>272</span>      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>273</span>      
<span class='line'>274</span>      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>275</span>    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>276</span>    
<span class='line'>277</span>    </span><span class="NAME">beginEditing</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>278</span>      
<span class='line'>279</span>      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'isEditing'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">YES</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>280</span>      
<span class='line'>281</span>      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'content'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>282</span>      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">del</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.displayDelegate</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>283</span>      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">labelKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getDelegateProperty</span><span class="PUNC">(</span><span class="NAME">del</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'contentValueKey'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>284</span>      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">labelKey</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">content</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">content.get</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">content.get</span><span class="PUNC">(</span><span class="NAME">labelKey</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>285</span>      
<span class='line'>286</span>      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">f</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.get</span><span class="PUNC">(</span><span class="STRN">'frame'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>287</span>      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.findLabelElement</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>288</span>      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">NO</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>289</span> 
<span class='line'>290</span>      </span><span class="COMM">// if the label has a large line height, try to adjust it to something</span><span class="WHIT">
<span class='line'>291</span>      </span><span class="COMM">// more reasonable so that it looks right when we show the popup editor.</span><span class="WHIT">
<span class='line'>292</span>      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oldLineHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Element.getStyle</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'lineHeight'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>293</span>      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fontSize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">Element.getStyle</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'fontSize'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>294</span>      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lineHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">oldLineHeight</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>295</span>      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lineHeightShift</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>296</span>      
<span class='line'>297</span>      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fontSize</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">lineHeight</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>298</span>        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">targetLineHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fontSize</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1.5</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>299</span>        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">targetLineHeight</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">lineHeight</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>300</span>          </span><span class="NAME">Element.setStyle</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">lineHeight</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'1.5'</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>301</span>          </span><span class="NAME">lineHeightShift</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">lineHeight</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">targetLineHeight</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="REGX">/ 2; 
<span class='line'>302</span>        } else oldLineHeight = null ;
<span class='line'>303</span>      }
<span class='line'>304</span>      
<span class='line'>305</span>      f.x += el.offsetLeft ;
<span class='line'>306</span>      f.y += el.offsetTop + lineHeightShift - 2;
<span class='line'>307</span>      f.height = el.offsetHeight ;
<span class='line'>308</span>      f.width = (f.width - 30 - el.offsetLeft) ;
<span class='line'>309</span>      f = this.convertFrameToView(f, null) ;
<span class='line'>310</span>      
<span class='line'>311</span>      var ret = SC.InlineTextFieldView.beginEditing({
<span class='line'>312</span>        frame: f, 
<span class='line'>313</span>        exampleElement: el, 
<span class='line'>314</span>        delegate: this, 
<span class='line'>315</span>        value: v
<span class='line'>316</span>      }) ;
<span class='line'>317</span> 
<span class='line'>318</span>      /</span><span class="REGX">/ restore old line height for original item if the old line height 
<span class='line'>319</span>      /</span><span class="REGX">/ was saved.
<span class='line'>320</span>      if (oldLineHeight) Element.setStyle(el, { lineHeight: oldLineHeight }) ;
<span class='line'>321</span>      
<span class='line'>322</span>      /</span><span class="REGX">/ Done!  If this failed, then set editing back to no.
<span class='line'>323</span>      return ret ;
<span class='line'>324</span>    },
<span class='line'>325</span>    
<span class='line'>326</span>    commitEditing: function() {
<span class='line'>327</span>      if (!this.get('isEditing')) return YES ;
<span class='line'>328</span>      return SC.InlineTextFieldView.commitEditing();
<span class='line'>329</span>    },
<span class='line'>330</span>    
<span class='line'>331</span>    discardEditing: function() {
<span class='line'>332</span>      if (!this.get('isEditing')) return YES ;
<span class='line'>333</span>      return SC.InlineTextFieldView.discardEditing();
<span class='line'>334</span>    },
<span class='line'>335</span>    
<span class='line'>336</span>    /</span><span class="PUNC">*</span><span class="PUNC">*</span><span class="WHIT"> </span><span class="TOKN">@</span><span class="NAME">private</span><span class="WHIT">
<span class='line'>337</span>      </span><span class="NAME">Set</span><span class="WHIT"> </span><span class="NAME">editing</span><span class="WHIT"> </span><span class="NAME">to</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="WHIT"> </span><span class="NAME">so</span><span class="WHIT"> </span><span class="NAME">edits</span><span class="WHIT"> </span><span class="NAME">will</span><span class="WHIT"> </span><span class="NAME">no</span><span class="WHIT"> </span><span class="NAME">longer</span><span class="WHIT"> </span><span class="NAME">be</span><span class="WHIT"> </span><span class="NAME">allowed.</span><span class="WHIT">
<span class='line'>338</span>    </span><span class="PUNC">*</span><span class="REGX">/
<span class='line'>339</span>    inlineEditorWillBeginEditing: function(inlineEditor) {
<span class='line'>340</span>      this.set('isEditing', YES);
<span class='line'>341</span>    },
<span class='line'>342</span> 
<span class='line'>343</span>    /</span><span class="PUNC">*</span><span class="PUNC">*</span><span class="WHIT"> </span><span class="TOKN">@</span><span class="NAME">private</span><span class="WHIT"> 
<span class='line'>344</span>      </span><span class="NAME">Hide</span><span class="WHIT"> </span><span class="NAME">the</span><span class="WHIT"> </span><span class="NAME">label</span><span class="WHIT"> </span><span class="NAME">view</span><span class="WHIT"> </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="NAME">the</span><span class="WHIT"> </span><span class="NAME">inline</span><span class="WHIT"> </span><span class="NAME">editor</span><span class="WHIT"> </span><span class="NAME">covers</span><span class="WHIT"> </span><span class="NAME">it.</span><span class="WHIT">
<span class='line'>345</span>    </span><span class="PUNC">*</span><span class="REGX">/
<span class='line'>346</span>    inlineEditorDidBeginEditing: function(inlineEditor) {
<span class='line'>347</span>      var el = this.findLabelElement() ;
<span class='line'>348</span>      this._oldOpacity = Element.getStyle(el, 'opacity') ;
<span class='line'>349</span>      Element.setStyle(el, { opacity: 0.0 }) ;
<span class='line'>350</span>    },
<span class='line'>351</span> 
<span class='line'>352</span>    /</span><span class="PUNC">*</span><span class="PUNC">*</span><span class="WHIT"> </span><span class="TOKN">@</span><span class="NAME">private</span><span class="WHIT">
<span class='line'>353</span>      </span><span class="NAME">Could</span><span class="WHIT"> </span><span class="NAME">check</span><span class="WHIT"> </span><span class="KEYW">with</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="NAME">validator</span><span class="WHIT"> </span><span class="NAME">someday...</span><span class="WHIT">
<span class='line'>354</span>    </span><span class="PUNC">*</span><span class="REGX">/
<span class='line'>355</span>    inlineEditorShouldEndEditing: function(inlineEditor, finalValue) {
<span class='line'>356</span>      return YES ;
<span class='line'>357</span>    },
<span class='line'>358</span> 
<span class='line'>359</span>    /</span><span class="PUNC">*</span><span class="PUNC">*</span><span class="WHIT"> </span><span class="TOKN">@</span><span class="NAME">private</span><span class="WHIT">
<span class='line'>360</span>      </span><span class="NAME">Update</span><span class="WHIT"> </span><span class="NAME">the</span><span class="WHIT"> </span><span class="NAME">field</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="NAME">and</span><span class="WHIT"> </span><span class="NAME">make</span><span class="WHIT"> </span><span class="NAME">it</span><span class="WHIT"> </span><span class="NAME">visible</span><span class="WHIT"> </span><span class="NAME">again.</span><span class="WHIT">
<span class='line'>361</span>    </span><span class="PUNC">*</span><span class="REGX">/
<span class='line'>362</span>    inlineEditorDidEndEditing: function(inlineEditor, finalValue) {
<span class='line'>363</span>      this.set('isEditing', NO) ;
<span class='line'>364</span> 
<span class='line'>365</span>      var content = this.get('content') ;
<span class='line'>366</span>      var del = this.displayDelegate ;
<span class='line'>367</span>      var labelKey = this.getDelegateProperty(del, 'contentValueKey') ;
<span class='line'>368</span>      if (labelKey && content && content.set) {
<span class='line'>369</span>        content.set(labelKey, finalValue) ;
<span class='line'>370</span>      }
<span class='line'>371</span>      
<span class='line'>372</span>      /</span><span class="REGX">/ force a refresh, otherwise the label will never be visible again
<span class='line'>373</span>      /</span><span class="REGX">/ b/</span><span class="NAME">c</span><span class="WHIT"> </span><span class="NAME">its</span><span class="WHIT"> </span><span class="NAME">opacity</span><span class="WHIT"> </span><span class="NAME">is</span><span class="WHIT"> </span><span class="NUMB">0.</span><span class="WHIT">
<span class='line'>374</span>      </span><span class="NAME">this._lastRenderedHtml</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>375</span>      </span><span class="NAME">this.render</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>376</span>    </span><span class="PUNC">}</span><span class="WHIT">   
<span class='line'>377</span>   
<span class='line'>378</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>379</span> </span></pre></body></html>